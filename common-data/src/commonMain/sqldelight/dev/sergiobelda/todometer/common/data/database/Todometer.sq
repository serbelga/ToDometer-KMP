import dev.sergiobelda.todometer.common.domain.model.Tag;
import dev.sergiobelda.todometer.common.domain.model.TaskState;

CREATE TABLE TaskListEntity (
    id TEXT PRIMARY KEY NOT NULL,
    name TEXT NOT NULL,
    description TEXT NOT NULL,
    sync INTEGER AS Boolean NOT NULL DEFAULT 0
);

CREATE TABLE TaskEntity (
    id TEXT PRIMARY KEY NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    state TEXT AS TaskState NOT NULL,
    tasklist_id TEXT NOT NULL,
    tag TEXT AS Tag NOT NULL,
    sync INTEGER AS Boolean NOT NULL DEFAULT 0,
    FOREIGN KEY(tasklist_id) REFERENCES TaskListEntity(id) ON UPDATE CASCADE ON DELETE CASCADE
);

-- CREATE TRIGGER autogenerate_uuid
-- AFTER INSERT ON TaskListEntity
-- FOR EACH ROW
-- WHEN (new.id IS NULL)
-- BEGIN
--    UPDATE TaskListEntity SET id = (SELECT hex( randomblob(4)) || '-' || hex( randomblob(2))
--                 || '-' || '4' || substr( hex( randomblob(2)), 2) || '-'
--                 || substr('AB89', 1 + (abs(random()) % 4) , 1)  ||
--                 substr(hex(randomblob(2)), 2) || '-' || hex(randomblob(6)));
-- END;

-------------------- Task

selectTask:
SELECT *
FROM TaskEntity
WHERE id = ?;

selectTasksByTaskListId:
SELECT *
FROM TaskEntity
WHERE tasklist_id = ?; ---- ORDER BY state ASC;

selectAllTasks:
SELECT *
FROM TaskEntity;

insertOrReplaceTask:
INSERT OR REPLACE INTO TaskEntity
(id, title, description, state, tasklist_id, tag, sync)
VALUES (?, ?, ?, ?, ?, ?, ?);

updateTask:
UPDATE TaskEntity
SET
    title = ?,
    description = ?,
    tag = ?
WHERE id = ?;

updateTaskSync:
UPDATE TaskEntity
SET
    sync = ?
WHERE id = ?;

updateTaskState:
UPDATE TaskEntity
SET
    state = ?
WHERE id = ?;

deleteTask:
DELETE FROM TaskEntity
WHERE id = ?;

-------------------- TaskList

selectTaskList:
SELECT *
FROM TaskListEntity
WHERE id = ?;

selectAllTaskLists:
SELECT *
FROM TaskListEntity;

insertTaskList:
INSERT INTO TaskListEntity
(id, name, description, sync)
VALUES (?, ?, ?, ?);

insertOrReplaceTaskList:
INSERT OR REPLACE INTO TaskListEntity
(id, name, description, sync)
VALUES (?,?, ?, ?);

updateTaskList:
UPDATE TaskListEntity
SET
    name = ?,
    description = ?,
    sync = ?
WHERE id = ?;

updateTaskListName:
UPDATE TaskListEntity
SET
    name = ?
WHERE id = ?;

deleteTaskList:
DELETE FROM TaskListEntity
WHERE id = ?;
